- name: Deploy Docker image to Kubernetes
  hosts: all
  become: yes
  tasks:

    - name: Update apt cache
      apt:
        update_cache: yes

    - name: Ensure python3, python3-pip and python3-kubernetes are installed
      apt:
        name:
          - python3
          - python3-pip
          - python3-kubernetes
        state: present

    - name: Apply Kubernetes manifest
      kubernetes.core.k8s:
        kubeconfig: "{{ ansible_env.HOME }}/.kube/config"
        state: present
        definition: "{{ lookup('file', 'kubernetesfile.yml') }}"
